/**
 * BNO055 Depth Sensor Driver
 * ONLY SUPPORTS 30BA variant as of now
 * Could be adapted later (changes calculations)
 * 
 * @file ms5837.h
 * @author Marcus Behel
 */

#include <util.h>

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// Typedefs
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

typedef struct {
    float depth_m;
    float pressure_mbar;
    float temperature_c;
} ms5837_data;


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// Globals
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

extern i2c_trans ms5837_trans;


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// Functions
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

/**
 * Initialize MS5837
 */
bool ms5837_init(void);

/**
 * Call from main when i2c transaction done
 */
void ms5837_i2c_done(void);

/**
 * Call from main when delay done
 */
void ms5837_delay_done(void);

/**
 * Get current depth sensor data
 */
ms5837_data ms5837_get(void);

/**
 * Check if the depth sensor is connected (and a valid sensor)
 * @return true once connected. Otherwise false.
 */
bool ms5837_connected(void);

/**
 * Reset depth sensor and state machine
 * Necessary if SDA line becomes held low or this sensor will stop responding
 */
void ms5837_reset(void);

// TODO: Remove this and debug the actual problem
void ms5837_fix_stuck(void);
