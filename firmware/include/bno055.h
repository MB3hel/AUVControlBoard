/**
 * @file bno055.h
 * 
 * BNO055 IMU driver using i2c0
 * 
 * @author Marcus Behel
 */

#pragma once

#include <stdbool.h>
#include  <stdint.h>


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// Macros
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

#define BNO055_AXIS_REMAP_P0        0
#define BNO055_AXIS_REMAP_P1        1
#define BNO055_AXIS_REMAP_P2        2
#define BNO055_AXIS_REMAP_P3        3
#define BNO055_AXIS_REMAP_P4        4
#define BNO055_AXIS_REMAP_P5        5
#define BNO055_AXIS_REMAP_P6        6
#define BNO055_AXIS_REMAP_P7        7


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// Typedefs
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

typedef struct {
    float grav_x, grav_y, grav_z;
    float quat_w, quat_x, quat_y, quat_z;
} bno055_data;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// Functions
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

/**
 * Initialize BNO055 IMU
 */
bool bno055_init(void);

/**
 * Call when bno055 delay finishes
 */
void bno055_delay_done(void);

/**
 * Call when bno055 i2c transaction may have finished
 */
void bno055_check_i2c(void);

/**
 * Reconfigure IMU
 * @param new_config New configuration for the IMU
 */
void bno055_reconfig(uint8_t axis_remap);

/**
 * Get BNO055 sensor data
 * 
 * @return bno055 
 */
bno055_data bno055_get(void);
