/**
 * @file bno055.h
 * 
 * BNO055 IMU driver using i2c0
 * 
 * @author Marcus Behel
 */

#pragma once

#include <stdbool.h>
#include  <stdint.h>


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// Macros
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

#define BNO055_AXIS_X       0b00
#define BNO055_AXIS_Y       0b01
#define BNO055_AXIS_Z       0b10

#define BNO055_SIGN_POS     0b00
#define BNO055_SIGN_NEG     0b01


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// Typedefs
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

typedef struct {
    uint8_t axis_x;
    uint8_t axis_y;
    uint8_t axis_z;
    uint8_t sign_x;
    uint8_t sign_y;
    uint8_t sign_z;
} bno055_config;

typedef struct {
    float grav_x, grav_y, grav_z;
    float quat_w, quat_x, quat_y, quat_z;
} bno055_data;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// Functions
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

/**
 * Initialize BNO055 IMU
 */
bool bno055_init(void);

/**
 * Call when bno055 delay finishes
 */
void bno055_delay_done(void);

/**
 * Call when bno055 i2c transaction may have finished
 */
void bno055_check_i2c(void);

/**
 * Reconfigure IMU
 * @param new_config New configuration for the IMU
 */
void bno055_reconfig(bno055_config new_config);

/**
 * Get BNO055 sensor data
 * 
 * @return bno055 
 */
bno055_data bno055_get(void);
